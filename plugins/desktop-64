# Test plugin

plugin_prebuild ()
{
cat <<'EOF' >> /mnt/gentoo/var/lib/portage/world
app-portage/eix
app-portage/cfg-update
kde-base/kde-meta
net-misc/x2goserver
media-fonts/font-misc-misc
media-fonts/font-cursor-misc
EOF

cat <<'EOF' >> /mnt/gentoo/etc/make.conf
USE="$USE X minizip qt3support"
EOF

cat <<'EOF' >> /mnt/gentoo/etc/portage/package.use
>=sys-libs/zlib-1.2.7 minizip
EOF


# The stable nx is apparently broken.

mkdir /mnt/gentoo/etc/portage
cat <<'EOF' >> /mnt/gentoo/etc/portage/package.keywords
net-misc/x2goserver
net-misc/nx
EOF

rm /mnt/gentoo/etc/portage/make.profile
rm /mnt/gentoo/etc/make.profile
ln -s /usr/portage/profiles/default/linux/amd64/10.0/desktop/kde /mnt/gentoo/etc/portage/make.profile

# gst-plugins-xvideo is apparently missing a libSM dependency

mount -t proc none /mnt/gentoo/proc
mount --rbind /dev /mnt/gentoo/dev
mount --rbind /dev/pts /mnt/gentoo/dev/pts

chroot /mnt/gentoo /usr/sbin/env-update
chroot /mnt/gentoo /usr/bin/emerge x11-libs/libSM

umount /mnt/gentoo/proc
umount -l /mnt/gentoo/dev/pts
umount -l /mnt/gentoo/dev

}

plugin_postbuild ()
{
chroot /mnt/gentoo /usr/bin/eix-update
chroot /mnt/gentoo /usr/sbin/x2godbadmin --createdb
}
